{%- comment -%}
  Section: MyEdenDay — Vitrine
  Fix: ensure collection/products resolve correctly in Theme Editor
{%- endcomment -%}

{{ 'section-myed-vitrine.css' | asset_url | stylesheet_tag }}
<script src="{{ 'section-myed-vitrine.js' | asset_url }}" defer="defer"></script>

{%- assign c = section.settings.collection -%}
{%- assign limit = section.settings.limit | default: 8 -%}

<section
  class="myed-vitrine"
  data-section-id="{{ section.id }}"
  data-layout="{{ section.settings.layout }}"
  data-meta-style="{{ section.settings.meta_style }}"
  data-panel-side="{{ section.settings.panel_side }}"
  style="
    --myed-vt-overlay: {{ section.settings.overlay | divided_by: 100.0 }};
    --myed-vt-shelf-y: {{ section.settings.shelf_y }}%;
    --myed-vt-media-h: {{ section.settings.media_h }}px;
  "
>
  <div class="myed-vt-bg">
    {%- if section.settings.bg_image -%}
      {{ section.settings.bg_image | image_url: width: 2400 | image_tag:
        class: 'myed-vt-bg__img',
        loading: 'lazy',
        widths: '960,1200,1600,2000,2400',
        sizes: '100vw',
        alt: section.settings.heading
      }}
    {%- endif -%}
    <div class="myed-vt-bg__overlay" aria-hidden="true"></div>
  </div>

  <div class="page-width myed-vt-inner">
    <header class="myed-vt-head">
      {%- if section.settings.kicker != blank -%}
        <div class="myed-vt-kicker">{{ section.settings.kicker }}</div>
      {%- endif -%}
      {%- if section.settings.heading != blank -%}
        <h2 class="myed-vt-title">{{ section.settings.heading }}</h2>
      {%- endif -%}
      {%- if section.settings.subheading != blank -%}
        <p class="myed-vt-sub">{{ section.settings.subheading }}</p>
      {%- endif -%}
    </header>

    <div class="myed-vt-stage" data-myed-vt-stage>
      <div class="myed-vt-shelf" aria-hidden="true"></div>

      {%- if section.settings.layout == 'carousel' -%}
        <div class="myed-vt-nav">
          <button class="myed-vt-nav__btn" type="button" data-myed-vt-prev aria-label="Previous">‹</button>
          <button class="myed-vt-nav__btn" type="button" data-myed-vt-next aria-label="Next">›</button>
        </div>
      {%- endif -%}

      <div class="myed-vt-list myed-vt-list--{{ section.settings.layout }}" data-myed-vt-list>
        {%- if c != blank and c.products_count > 0 -%}
          {%- for p in c.products limit: limit -%}
            {%- render 'myed-vitrine-card', product: p -%}
          {%- endfor -%}
        {%- else -%}
          <div class="myed-vt-empty">Keine Kollektion gewählt oder keine Produkte vorhanden.</div>
        {%- endif -%}
      </div>

      {%- if section.settings.reflection -%}
        <div class="myed-vt-reflection" aria-hidden="true"></div>
      {%- endif -%}
    </div>
  </div>

  <!-- Quick Panel -->
  <div class="myed-vt-panel" data-myed-vt-panel aria-hidden="true">
    <div class="myed-vt-panel__backdrop" data-myed-vt-close></div>

    <div class="myed-vt-panel__dialog" role="dialog" aria-modal="true" aria-label="Product details" tabindex="-1">
      <button class="myed-vt-panel__close" type="button" data-myed-vt-close aria-label="Close">×</button>

      <div class="myed-vt-panel__grid">
        <div class="myed-vt-panel__media">
          <div class="myed-vt-gallery" data-myed-vt-gallery></div>
        </div>

        <div class="myed-vt-panel__content">
          <div class="myed-vt-panel__title" data-myed-vt-panel-title></div>

          <div class="myed-vt-panel__price">
            <span data-myed-vt-panel-price></span>
            <span class="myed-vt-panel__compare" data-myed-vt-panel-compare></span>
          </div>

          <div class="myed-vt-panel__desc" data-myed-vt-panel-desc></div>

          <div class="myed-vt-panel__actions">
            <a class="myed-vt-btn myed-vt-btn--primary" data-myed-vt-panel-url href="#">Produkt ansehen</a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="myed-vitrine__sheet" hidden>
    <div class="myed-vitrine__sheet-backdrop" data-sheet-close></div>

    <div class="myed-vitrine__sheet-panel" role="dialog" aria-modal="true" aria-label="Product details">
      <button class="myed-vitrine__sheet-close" type="button" aria-label="Close" data-sheet-close>×</button>

      <div class="myed-vitrine__sheet-media">
        <img class="myed-vitrine__sheet-img" alt="" loading="lazy">
      </div>

      <div class="myed-vitrine__sheet-body">
        <div class="myed-vitrine__sheet-title" data-sheet-title></div>
        <div class="myed-vitrine__sheet-price" data-sheet-price></div>

        <div class="myed-vitrine__sheet-kicker" data-sheet-kicker></div>

        <div class="myed-vitrine__sheet-items" data-sheet-items hidden>
          {% for i in (1..5) %}
            <details class="myed-vitrine__sheet-item" data-sheet-item="{{ i }}" hidden>
              <summary class="myed-vitrine__sheet-itemsum">
                <span data-sheet-item-title="{{ i }}"></span>
                <span class="myed-vitrine__sheet-itemicon">+</span>
              </summary>
              <div class="myed-vitrine__sheet-itembody" data-sheet-item-body="{{ i }}"></div>
            </details>
          {% endfor %}
        </div>

        <div class="myed-vitrine__sheet-actions">
          <a class="myed-vitrine__sheet-cta button" href="#" data-sheet-url>In den Warenkorb</a>
          <a class="myed-vitrine__sheet-link" href="#" data-sheet-url-secondary>Details</a>
        </div>
      </div>
    </div>
  </div>

</section>

{% schema %}
{
  "name": "MyEdenDay — Vitrine",
  "settings": [
    { "type": "image_picker", "id": "bg_image", "label": "Background image" },
    { "type": "range", "id": "overlay", "label": "Overlay (%)", "min": 0, "max": 70, "step": 5, "default": 35 },

    { "type": "text", "id": "kicker", "label": "Kicker", "default": "MYEDENDAY VITRINE" },
    { "type": "text", "id": "heading", "label": "Heading", "default": "IHRE MORGENROUTINE" },
    { "type": "text", "id": "subheading", "label": "Subheading", "default": "Wählen Sie Ihre Routine für einen klaren Start in den Tag" },

    { "type": "collection", "id": "collection", "label": "Collection" },
    { "type": "range", "id": "limit", "label": "Max products", "min": 3, "max": 12, "step": 1, "default": 8 },
    { "type": "range", "id": "shelf_y", "label": "Shelf vertical position (%)", "min": 55, "max": 85, "step": 1, "default": 72 },
    { "type": "range", "id": "media_h", "label": "Product media height (px)", "min": 140, "max": 320, "step": 10, "default": 240 },
    {
      "type": "select",
      "id": "meta_style",
      "label": "Meta style",
      "default": "compact",
      "options": [
        { "value": "compact", "label": "Compact" },
        { "value": "wide", "label": "Wide" }
      ]
    },
    {
      "type": "select",
      "id": "panel_side",
      "label": "Panel side",
      "default": "right",
      "options": [
        { "value": "right", "label": "Right" },
        { "value": "left", "label": "Left" }
      ]
    },

    {
      "type": "select",
      "id": "layout",
      "label": "Layout",
      "default": "carousel",
      "options": [
        { "value": "carousel", "label": "Carousel (scroll-snap)" },
        { "value": "grid", "label": "Grid" }
      ]
    },

    { "type": "checkbox", "id": "reflection", "label": "Enable floor reflection", "default": true }
  ],
  "presets": [{ "name": "MyEdenDay — Vitrine" }]
}
{% endschema %}
