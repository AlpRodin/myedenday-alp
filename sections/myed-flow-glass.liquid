{%- comment -%}
  MyEdenDay — Professional Flow Thumbs (Glass + Rich Text)
  - Added: Rich Text Intro (Heading + Description)
  - Added: Glassmorphism Styling
  - Keep: Marquee logic
{%- endcomment -%}

{%- liquid
  assign ns = 'myed-flow-thumbs-' | append: section.id
  assign has_top = false
  assign has_thumbs = false
  assign thumb_count = 0

  for block in section.blocks
    case block.type
      when 'marquee_item'
        if block.settings.position == 'top'
          assign has_top = true
        endif
      when 'thumb_item'
        if block.settings.image != blank
          assign has_thumbs = true
          assign thumb_count = thumb_count | plus: 1
        endif
    endcase
  endfor
-%}

<section
  id="{{ ns }}"
  class="{{ ns }}"
  style="
    --myed-bg: {{ section.settings.bg_color }};
    --myed-text: {{ section.settings.text_color }};
    --myed-accent: {{ section.settings.accent_color }};
    --myed-maxw: {{ section.settings.max_width }}px;
    --myed-py: {{ section.settings.padding_y }}px;
    --myed-gap: {{ section.settings.gap }}px;

    /* Glass Settings */
    --glass-bg: rgba(255, 255, 255, 0.45);
    --glass-border: rgba(255, 255, 255, 0.6);
    --glass-blur: 16px;

    --myed-marquee-h: {{ section.settings.thumb_height }}px;
    --myed-marquee-gap: {{ section.settings.thumb_gap }}px;
    --myed-marquee-radius: {{ section.settings.thumb_radius }}px;
    --myed-marquee-speed: {{ section.settings.thumb_speed }}s;
    --myed-thumb-w: {{ section.settings.thumb_max_width }}px;
  "
>
  <div class="{{ ns }}__wrap">

    {%- comment -%} --- RICH TEXT INTRO (NEW) --- {%- endcomment -%}
    {%- if section.settings.heading != blank or section.settings.content != blank -%}
      <div class="{{ ns }}__intro">
        {%- if section.settings.heading != blank -%}
          <h2 class="{{ ns }}__heading">{{ section.settings.heading | escape }}</h2>
        {%- endif -%}
        {%- if section.settings.content != blank -%}
          <div class="{{ ns }}__text">{{ section.settings.content }}</div>
        {%- endif -%}
        <div class="{{ ns }}__divider"></div>
      </div>
    {%- endif -%}

    {%- comment -%} --- TOP MARQUEE --- {%- endcomment -%}
    {%- if section.settings.show_top_marquee and has_top -%}
      <div class="{{ ns }}__tmarquee glass-panel" role="note" aria-label="Announcements">
        <div class="{{ ns }}__ttrack" style="--myed-t-speed: {{ section.settings.top_marquee_speed }}s; --myed-t-dir: {{ section.settings.top_marquee_direction }};">
          {%- for i in (1..4) -%}
          <div class="{{ ns }}__tinner" {% if i > 1 %}aria-hidden="true"{% endif %}>
            {%- for block in section.blocks -%}
              {%- if block.type == 'marquee_item' and block.settings.position == 'top' -%}
                <span class="{{ ns }}__titem" {{ block.shopify_attributes }}>
                  <span class="{{ ns }}__icon">✦</span>
                  {%- if block.settings.link != blank -%}
                    <a class="{{ ns }}__tlink" href="{{ block.settings.link }}">{{ block.settings.text | escape }}</a>
                  {%- else -%}
                    {{ block.settings.text | escape }}
                  {%- endif -%}
                </span>
              {%- endif -%}
            {%- endfor -%}
          </div>
          {%- endfor -%}
        </div>
      </div>
    {%- endif -%}

    {%- comment -%} --- THUMBNAIL STRIP --- {%- endcomment -%}
    {%- if section.settings.show_thumb_strip and has_thumbs -%}
      <div class="{{ ns }}__thumbRow" aria-label="Image strip">
        <div class="{{ ns }}__thumbShell glass-panel">
          <div class="{{ ns }}__thumbTrack{% if thumb_count < 2 %} is-static{% endif %}">
            {%- for i in (1..4) -%}
            <div class="{{ ns }}__thumbInner" {% if i > 1 %}aria-hidden="true"{% endif %}>
              {%- for block in section.blocks -%}
                {%- if block.type == 'thumb_item' and block.settings.image != blank -%}
                  {%- assign img = block.settings.image -%}
                  <a
                    class="{{ ns }}__thumb"
                    href="{{ block.settings.link | default: '#' }}"
                    {% if block.settings.link == blank %}aria-disabled="true"{% endif %}
                    {{ block.shopify_attributes }}
                  >
                    <img
                      class="{{ ns }}__thumbImg"
                      src="{{ img | image_url: width: section.settings.thumb_max_width }}"
                      alt="{{ block.settings.alt | escape }}"
                      loading="lazy"
                      width="{{ img.width }}"
                      height="{{ img.height }}"
                    >
                  </a>
                {%- endif -%}
              {%- endfor -%}
            </div>
            {%- endfor -%}
          </div>
        </div>
      </div>
    {%- endif -%}

  </div>

  <style>
    #{{ ns }}{
      --fg-maxw: {{ section.settings.max_width }}px;
      --fg-pad-y: {{ section.settings.padding_y }}px;
      --fg-gap-y: {{ section.settings.gap }}px;
      --fg-text-speed: {{ section.settings.top_marquee_speed }}s;
      --fg-img-h: {{ section.settings.thumb_height }}px;
      --fg-img-radius: {{ section.settings.thumb_radius }}px;
      --fg-img-gap: {{ section.settings.thumb_gap }}px;
      --fg-img-speed: {{ section.settings.thumb_speed }}s;
    }

    .{{ ns }}{
      background: var(--myed-bg);
      color: var(--myed-text);
      overflow: hidden;
      position: relative;
    }

    /* Background Gradient Elements (Optional for depth) */
    .{{ ns }}::before {
        content: ''; position: absolute; top: -20%; left: -10%; width: 50%; height: 50%;
        background: radial-gradient(circle, var(--myed-accent) 0%, transparent 70%);
        opacity: 0.1; pointer-events: none; filter: blur(60px);
    }

    .{{ ns }}__wrap{
      max-width: var(--fg-maxw, 1200px);
      margin: 0 auto;
      padding: var(--fg-pad-y, 60px) 20px;
      display: flex;
      flex-direction: column;
      gap: var(--fg-gap-y, 30px);
    }

    /* INTRO STYLES */
    .{{ ns }}__intro { text-align: center; margin-bottom: 10px; max-width: 800px; margin-inline: auto; }
    .{{ ns }}__heading { font-family: serif; font-size: 32px; margin: 0 0 10px 0; color: var(--myed-text); font-weight: 300; }
    .{{ ns }}__text { font-size: 16px; opacity: 0.8; line-height: 1.6; }
    .{{ ns }}__divider { width: 60px; height: 1px; background: var(--myed-accent); margin: 20px auto; opacity: 0.5; }

    /* GLASS UTILITY */
    .glass-panel {
        background: var(--glass-bg);
        backdrop-filter: blur(var(--glass-blur)) saturate(180%);
        -webkit-backdrop-filter: blur(var(--glass-blur)) saturate(180%);
        border: 1px solid var(--glass-border);
        box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.05);
    }

    /* TEXT MARQUEE */
    .{{ ns }}__tmarquee{
      overflow: hidden;
      border-radius: 999px;
      padding: 6px 0;
    }
    .{{ ns }}__ttrack{
      display: flex;
      width: max-content;
      will-change: transform;
      animation: {{ ns }}-move var(--fg-text-speed, 30s) linear infinite;
      animation-direction: alternate; /* Can be normal or reverse based on setting */
    }
    .{{ ns }}__tinner{
      display: flex;
      align-items: center;
      gap: 30px;
      padding: 0 15px;
    }
    .{{ ns }}__titem{
      font-size: 13px;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      font-weight: 600;
      display: inline-flex; align-items: center; gap: 8px;
    }
    .{{ ns }}__icon { color: var(--myed-accent); font-size: 10px; }
    .{{ ns }}__tlink{ color: inherit; text-decoration: none; border-bottom: 1px solid transparent; transition: border-color 0.3s; }
    .{{ ns }}__tlink:hover { border-color: currentColor; }

    /* THUMB MARQUEE */
    .{{ ns }}__thumbRow{ overflow: hidden; }
    .{{ ns }}__thumbShell{
      border-radius: 20px; /* Modern Rounded Corners */
      overflow: hidden;
      padding: 10px 0;
    }
    .{{ ns }}__thumbTrack{
      display: flex;
      width: max-content;
      will-change: transform;
      animation: {{ ns }}-move var(--fg-img-speed, 40s) linear infinite;
    }
    .{{ ns }}__thumbInner{
      display: flex;
      align-items: center;
      gap: var(--fg-img-gap, 20px);
      padding-right: var(--fg-img-gap, 20px);
    }
    .{{ ns }}__thumb{
      display: block;
      height: var(--fg-img-h, 120px);
      width: auto;
      max-width: var(--myed-thumb-w);
      border-radius: var(--fg-img-radius, 12px);
      overflow: hidden;
      transition: transform 0.3s ease;
    }
    .{{ ns }}__thumb:hover { transform: scale(1.05); }
    .{{ ns }}__thumbImg{
      display: block;
      height: 100%;
      width: auto;
      object-fit: cover;
    }

    @keyframes {{ ns }}-move{
      0% { transform: translateX(0); }
      100% { transform: translateX(-100%); }
    }

    /* Pause on Hover */
    .{{ ns }}:hover .{{ ns }}__thumbTrack,
    .{{ ns }}:hover .{{ ns }}__ttrack{ animation-play-state: paused; }

    {% if section.settings.enable_mobile_overrides %}
    @media (max-width: 749px){
      #{{ ns }}{
        --fg-maxw: {{ section.settings.max_width_mobile }}px;
        --fg-pad-y: {{ section.settings.vertical_padding_mobile }}px;
        --fg-gap-y: {{ section.settings.vertical_gap_mobile }}px;

        --fg-text-speed: {{ section.settings.text_speed_mobile }}s;

        --fg-img-h: {{ section.settings.image_height_mobile }}px;
        --fg-img-radius: {{ section.settings.image_radius_mobile }}px;
        --fg-img-gap: {{ section.settings.image_gap_mobile }}px;
        --fg-img-speed: {{ section.settings.image_speed_mobile }}s;
      }
    }
    {% endif %}
  </style>
</section>

{% schema %}
{
  "name": "MyED Flow Glass",
  "settings": [
    { "type": "header", "content": "Rich Text Intro" },
    { "type": "text", "id": "heading", "label": "Heading", "default": "Unsere Welt entdecken" },
    { "type": "richtext", "id": "content", "label": "Description", "default": "<p>Eine kuratierte Sammlung von Momenten und Produkten.</p>" },

    { "type": "header", "content": "Colors & Layout" },
    { "type": "color", "id": "bg_color", "label": "Background", "default": "transparent" },
    { "type": "color", "id": "text_color", "label": "Text", "default": "#333333" },
    { "type": "color", "id": "accent_color", "label": "Accent (Gold)", "default": "#C5A065" },
    { "type": "range", "id": "max_width", "min": 960, "max": 1440, "step": 20, "label": "Max width", "default": 1200 },
    { "type": "range", "id": "padding_y", "min": 20, "max": 100, "step": 4, "label": "Vertical padding", "default": 60 },
    { "type": "range", "id": "gap", "min": 10, "max": 60, "step": 1, "label": "Vertical Gap", "default": 30 },

    { "type": "header", "content": "Marquee Settings" },
    { "type": "checkbox", "id": "show_top_marquee", "label": "Show Text Marquee", "default": true },
    { "type": "range", "id": "top_marquee_speed", "min": 10, "max": 60, "step": 2, "label": "Text Speed (s)", "default": 30 },

    { "type": "checkbox", "id": "show_thumb_strip", "label": "Show Image Strip", "default": true },
    { "type": "range", "id": "thumb_height", "min": 60, "max": 200, "step": 5, "label": "Image Height (px)", "default": 120 },
    { "type": "range", "id": "thumb_radius", "min": 0, "max": 40, "step": 2, "label": "Image Radius (px)", "default": 12 },
    { "type": "range", "id": "thumb_gap", "min": 10, "max": 50, "step": 2, "label": "Image Gap (px)", "default": 20 },
    { "type": "range", "id": "thumb_speed", "min": 10, "max": 100, "step": 1, "label": "Image Speed (s)", "default": 40 },

    { "type": "header", "content": "Mobile Overrides" },
    { "type": "checkbox", "id": "enable_mobile_overrides", "label": "Separate mobile settings", "default": false },
    { "type": "range", "id": "max_width_mobile", "min": 320, "max": 1400, "step": 20, "label": "Max width (mobile)", "default": 1200 },
    { "type": "range", "id": "vertical_padding_mobile", "min": 0, "max": 160, "step": 4, "label": "Vertical padding (mobile)", "default": 60 },
    { "type": "range", "id": "vertical_gap_mobile", "min": 0, "max": 120, "step": 2, "label": "Vertical gap (mobile)", "default": 30 },
    { "type": "range", "id": "text_speed_mobile", "min": 10, "max": 120, "step": 2, "label": "Text speed (mobile)", "default": 30 },
    { "type": "range", "id": "image_height_mobile", "min": 40, "max": 220, "step": 2, "label": "Image height (mobile)", "default": 120 },
    { "type": "range", "id": "image_radius_mobile", "min": 0, "max": 40, "step": 1, "label": "Image radius (mobile)", "default": 12 },
    { "type": "range", "id": "image_gap_mobile", "min": 0, "max": 40, "step": 1, "label": "Image gap (mobile)", "default": 20 },
    { "type": "range", "id": "image_speed_mobile", "min": 10, "max": 120, "step": 2, "label": "Image speed (mobile)", "default": 40 }
  ],
  "blocks": [
    {
      "type": "marquee_item",
      "name": "Text Item",
      "settings": [
        { "type": "select", "id": "position", "label": "Position", "default": "top", "options": [{ "value": "top", "label": "Top" }] },
        { "type": "text", "id": "text", "label": "Text", "default": "Free shipping over €50" },
        { "type": "url", "id": "link", "label": "Link" }
      ]
    },
    {
      "type": "thumb_item",
      "name": "Image Item",
      "settings": [
        { "type": "image_picker", "id": "image", "label": "Image" },
        { "type": "text", "id": "alt", "label": "Alt text" },
        { "type": "url", "id": "link", "label": "Link" }
      ]
    }
  ],
  "presets": [
    { "name": "MyED Flow Glass" }
  ]
}
{% endschema %}
